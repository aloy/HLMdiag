<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagnostic Tools for Hierarchical (Multilevel) Linear Models • HLMdiag</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Diagnostic Tools for Hierarchical (Multilevel) Linear Models">
<meta property="og:description" content="A suite of diagnostic tools for hierarchical
    (multilevel) linear models. The tools include
    not only leverage and traditional deletion diagnostics (Cooks
    distance, covratio, covtrace, and MDFFITS) but also 
    convenience functions and graphics for residual analysis. Models
    can be fit using either lmer in the lme4 package or lme in the nlme' package.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">HLMdiag</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/hlm_resid.html">Residual Diagnostics</a>
    </li>
    <li>
      <a href="articles/influence_diagnostics.html">Influence Diagnostics</a>
    </li>
    <li>
      <a href="articles/jss_update.html">Updated JSS code</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aloy/HLMdiag/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="hlmdiag-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#hlmdiag-" class="anchor"></a>HLMdiag <img src="reference/figures/logo.png" align="right" height="139">
</h1></div>

<p>The package <code>HLMdiag</code> was created in order to provide a unified framework for analysts to diagnose hierarchical linear models (HLMs). When <code>HLMdiag</code> was created in 2014, it made diagnostic procedures available for HLMs that had not yet been implemented in statistical software. Over the past 6 years, other packages have gradually implemented some of these procedures; however, diagnosing a model still often requires multiple packages, each of which has its own syntax and quirks. <code>HLMdiag</code> provides diagnostic tools targeting all aspects and levels of hierarchical linear models in a single package. <code>HLMdiag</code> provides wrapper functions to all types of residuals implemented in <code>lme4</code> and <code>nlme</code> as well as providing access to the marginal and least squares residuals. For influence diagnostics, <code>HLMdiag</code> provides functions to calculate Cook’s distance, MDFFITS, covariance trace and ratio, relative variance change, and leverage.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>If you would like to install the development version of <code>HLMdiag</code>, you may do so using <code>devtools</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("devtools")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"aloy/HLMdiag"</span><span class="op">)</span></code></pre></div>
<p>To instead download the stable CRAN version instead, use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"HLMdiag"</span><span class="op">)</span></code></pre></div>
</div>
<div id="details" class="section level2">
<h2 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h2>
<p>The functions provided by this package can be separated into three groups: residual analysis, influence analysis, and graphical tools.</p>
</div>
<div id="residual-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#residual-analysis" class="anchor"></a>Residual Analysis</h2>
<p>The residual functions in <code>HLMdiag</code> allow the analyst to estimate all types of residuals defined for a hierarchical linear model. They provide access to level-1, higher-level, and marginal residuals and use both Least Squares and Empirical Bayes estimation methods to provide the analyst with more choices in evaluating a model. The <code>hlm_resid</code> method is inspired by the <code>augment()</code> function in <code>broom</code> and appends all types of residuals and fitted values for a given level to the model frame; however, individual types of residuals can be calculated with the <code>pull_resid</code> method.</p>
<p>The functions available for residual analysis in <code>HLMdiag</code> are: *<code><a href="reference/hlm_resid.default.html">hlm_resid()</a></code> calculates all residual diagnostics for a given level, returning a tibble with the residuals and fitted values appended to the original model frame.</p>
<p>*<code><a href="reference/pull_resid.default.html">pull_resid()</a></code> calculates a specified type of residual, returning a vector and prioritizing computational efficiency.</p>
<p>*<code><a href="reference/hlm_augment.html">hlm_augment()</a></code> combines <code><a href="reference/hlm_influence.default.html">hlm_influence()</a></code> and <code><a href="reference/hlm_resid.default.html">hlm_resid()</a></code> to return a tibble with residual values and influence diagnostics appended to the original model frame.</p>
<div id="influence-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#influence-analysis" class="anchor"></a>Influence Analysis</h3>
<p>The influence analysis functions provide functionality to calculate Cook’s distance, MDFFITS, covariance ratio, covariance trace, relative variance change, and leverage. Additionally, two functions to calculate Cook’s distance, MDFFITS, covariance ratio, and covariance trace are provided: a one step approximation, and a full refit method that refits the model and recalculates the fixed and random effects. This functionality is available through individual functions for each diagnostic; however, the <code>hlm_influence</code> function can be used to calculate all available diagnostics for each observation or group of observations.</p>
<p>The functions available for influence analysis in <code>HLMdiag</code> are:</p>
<ul>
<li>
<code><a href="reference/mdffits.default.html">cooks.distance()</a></code> calculates Cook’s distance values, which measures the difference between the original fixed effects and the deleted ones.</li>
<li>
<code><a href="reference/mdffits.default.html">mdffits()</a></code> calculates MDFFITS, a multivariate version of the DFFITS statistic, which is also a measure of the difference in fixed effects.</li>
<li>
<code><a href="reference/covratio.default.html">covtrace()</a></code> calculates covariance trace, the ratio between the covariance matrices with and without unit <em>i</em> to the identity matrix.</li>
<li>
<code><a href="reference/covratio.default.html">covratio()</a></code> calculate covariance ratio, a comparison of the two covariance matrices with and without unit <em>i</em> using their determinants.</li>
<li>
<code><a href="reference/rvc.default.html">rvc()</a></code> calculates relative variance change, a measurement of the ratio of estimates of the <em>l</em> th variance component with and without unit <em>i</em>.</li>
<li>
<code><a href="reference/leverage.default.html">leverage()</a></code> calculates leverage, he rate of change in the predicted response with respect to the observed response.</li>
<li>
<code><a href="reference/case_delete.default.html">case_delete()</a></code> iteratively deletes observations or groups of observations, returning a list of fixed and random components from the original model and the models created by deletion.</li>
<li>
<code><a href="reference/hlm_influence.default.html">hlm_influence()</a></code> calculates all of the influence diagnostics, returning a tibble with the influence values appended to the original model frame.</li>
<li>
<code><a href="reference/hlm_augment.html">hlm_augment()</a></code> combines <code><a href="reference/hlm_influence.default.html">hlm_influence()</a></code> and <code><a href="reference/hlm_resid.default.html">hlm_resid()</a></code> to return a tibble with residual values and influence diagnostics appended to the original model frame.</li>
</ul>
</div>
<div id="graphical-tools" class="section level3">
<h3 class="hasAnchor">
<a href="#graphical-tools" class="anchor"></a>Graphical Tools</h3>
<p><code>HLMdiag</code> provides the function <code><a href="reference/dotplot_diag.html">dotplot_diag()</a></code>, which creates dotplots to visually represent influence diagnostics. It is especially useful when used with the values returned by <code><a href="reference/hlm_influence.default.html">hlm_influence()</a></code>. <code>HLMdiag</code> also provides grouped Q-Q plots (<code><a href="reference/HLMdiag-defunct.html">group_qqnorm()</a></code>), and Q-Q plots that combine the functionality of qqnorm and qqline (<code><a href="reference/HLMdiag-defunct.html">ggplot_qqnorm()</a></code>).</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="residual-analysis-1" class="section level3">
<h3 class="hasAnchor">
<a href="#residual-analysis-1" class="anchor"></a>Residual Analysis</h3>
<p>We will use the <code>sleepstudy</code> data set from the <code>lme4</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aloy/HLMdiag">HLMdiag</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'HLMdiag'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     covratio</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">sleepstudy</span>, package <span class="op">=</span> <span class="st">"lme4"</span><span class="op">)</span>
<span class="va">sleep.lmer</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="va">Days</span><span class="op">|</span><span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span> </code></pre></div>
<p>We calculate the unstandardized level-1 and marginal residuals for each observation below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/hlm_resid.default.html">hlm_resid</a></span><span class="op">(</span><span class="va">sleep.lmer</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 180 x 10</span>
<span class="co">#&gt;       id Reaction  Days Subject  .resid .fitted .ls.resid .ls.fitted .mar.resid</span>
<span class="co">#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1     250.     0 308       -4.10    254.      5.37       244.      -1.85</span>
<span class="co">#&gt;  2     2     259.     1 308      -14.6     273.     -7.25       266.      -3.17</span>
<span class="co">#&gt;  3     3     251.     2 308      -42.2     293.    -36.9        288.     -21.5 </span>
<span class="co">#&gt;  4     4     321.     3 308        8.78    313.     12.0        309.      38.6 </span>
<span class="co">#&gt;  5     5     357.     4 308       24.5     332.     25.6        331.      63.6 </span>
<span class="co">#&gt;  6     6     415.     5 308       62.7     352.     61.7        353.     111.  </span>
<span class="co">#&gt;  7     7     382.     6 308       10.5     372.      7.42       375.      68.0 </span>
<span class="co">#&gt;  8     8     290.     7 308     -101.      391.   -106.         397.     -34.5 </span>
<span class="co">#&gt;  9     9     431.     8 308       19.6     411.     12.3        418.      95.4 </span>
<span class="co">#&gt; 10    10     466.     9 308       35.7     431.     26.3        440.     121.  </span>
<span class="co">#&gt; # … with 170 more rows, and 1 more variable: .mar.fitted &lt;dbl&gt;</span></code></pre></div>
<p>For more information and examples of the functionality of <code><a href="reference/hlm_resid.default.html">hlm_resid()</a></code>, see the residual diagnostics vignette.</p>
</div>
<div id="influence-analysis-1" class="section level3">
<h3 class="hasAnchor">
<a href="#influence-analysis-1" class="anchor"></a>Influence Analysis</h3>
<p>We calculate influence diagnostics for each observation with the following line:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/hlm_influence.default.html">hlm_influence</a></span><span class="op">(</span><span class="va">sleep.lmer</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 180 x 9</span>
<span class="co">#&gt;       id Reaction  Days Subject  cooksd mdffits covtrace covratio</span>
<span class="co">#&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1     250.     0 308     1.48e-4 1.47e-4 0.00887      1.01</span>
<span class="co">#&gt;  2     2     259.     1 308     1.10e-3 1.09e-3 0.00558      1.01</span>
<span class="co">#&gt;  3     3     251.     2 308     5.13e-3 5.11e-3 0.00330      1.00</span>
<span class="co">#&gt;  4     4     321.     3 308     1.14e-4 1.14e-4 0.00175      1.00</span>
<span class="co">#&gt;  5     5     357.     4 308     3.93e-4 3.92e-4 0.000778     1.00</span>
<span class="co">#&gt;  6     6     415.     5 308     1.07e-3 1.07e-3 0.000321     1.00</span>
<span class="co">#&gt;  7     7     382.     6 308     3.49e-5 3.49e-5 0.000361     1.00</span>
<span class="co">#&gt;  8     8     290.     7 308     8.81e-3 8.80e-3 0.000944     1.00</span>
<span class="co">#&gt;  9     9     431.     8 308     8.23e-4 8.21e-4 0.00219      1.00</span>
<span class="co">#&gt; 10    10     466.     9 308     5.99e-3 5.96e-3 0.00435      1.00</span>
<span class="co">#&gt; # … with 170 more rows, and 1 more variable: leverage.overall &lt;dbl&gt;</span></code></pre></div>
<p>For more information and examples of the functionality of <code><a href="reference/hlm_influence.default.html">hlm_influence()</a></code>, see the influence diagnostics vignette.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=HLMdiag">https://​cloud.r-project.org/​package=HLMdiag</a>
</li>
<li>Browse source code at <br><a href="https://github.com/aloy/HLMdiag/">https://​github.com/​aloy/​HLMdiag/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/aloy/HLMdiag/issues">https://​github.com/​aloy/​HLMdiag/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing HLMdiag</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Adam Loy <br><small class="roles"> Maintainer, author </small>  </li>
<li>Jaylin Lowe <br><small class="roles"> Author </small>  </li>
<li>Jack Moran <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/aloy/HLMdiag/actions"><img src="https://github.com/aloy/HLMdiag/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://cran.r-project.org/package=HLMdiag"><img src="http://www.r-pkg.org/badges/version/HLMdiag" alt="CRAN_Status_Badge"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Adam Loy, Jaylin Lowe, Jack Moran.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
