<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculating residuals from HLMs — HLMresid.default • HLMdiag</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculating residuals from HLMs — HLMresid.default" />
<meta property="og:description" content="HLMresid is a function that extracts residuals
from a hierarchical linear model fit
using lmer. That is, it is a unified framework that
extracts/calculates residuals from mer or lmerMod objects." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HLMdiag</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/hlm_resid.html">HLMdiag Residual Diagnostics</a>
    </li>
    <li>
      <a href="../articles/influence_diagnostics.html">Influence Diagnostics</a>
    </li>
    <li>
      <a href="../articles/jss_update.html">Updated code for JSS analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/aloy/HLMdiag/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculating residuals from HLMs</h1>
    <small class="dont-index">Source: <a href='https://github.com/aloy/HLMdiag/blob/master/R/HLMresid.R'><code>R/HLMresid.R</code></a></small>
    <div class="hidden name"><code>HLMresid.mer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>HLMresid</code> is a function that extracts residuals
from a hierarchical linear model fit
using <code>lmer</code>. That is, it is a unified framework that
extracts/calculates residuals from <code>mer</code> or <code>lmerMod</code> objects.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for default</span>
<span class='fu'>HLMresid</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for mer</span>
<span class='fu'>HLMresid</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>level</span>, type <span class='op'>=</span> <span class='st'>"EB"</span>, sim <span class='op'>=</span> <span class='cn'>NULL</span>, standardize <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for lmerMod</span>
<span class='fu'>HLMresid</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>level</span>, type <span class='op'>=</span> <span class='st'>"EB"</span>, sim <span class='op'>=</span> <span class='cn'>NULL</span>, standardize <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>an object of class <code>mer</code> or <code>lmerMod</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>do not use</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>which residuals should be extracted: 1 for within-group (case-level)
residuals, the name of a grouping factor (as defined in <code>flist</code> of the 
<code>mer</code> object) for between-group residuals, or <code>marginal</code>.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>how are the residuals predicted: either <code>"EB"</code> or <code>"LS"</code>
(the default is <code>"EB"</code>).</p></td>
    </tr>
    <tr>
      <th>sim</th>
      <td><p>optional argument giving the data frame used for LS residuals. This
is used mainly for dealing with simulations.</p></td>
    </tr>
    <tr>
      <th>standardize</th>
      <td><p>if <code>standardize = TRUE</code> the standardized
residuals will be returned; if <code>standardize = "semi"</code> then
the semi-standardized level-1 residuals will be returned. Note that
for higher-level residuals of <code>type = "LS"</code>,  <code>standardize = TRUE</code> 
does not result in standardized residuals as they have not been implemented.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function extracts residuals from the model, 
and can extract residuals
estimated using least squares (LS) or Empirical 
Bayes (EB). This unified framework
enables the analyst to more easily conduct
an upward residual analysis during model
exploration/checking.</p>
<p>The <code>HLMresid</code> function provides a wrapper that will extract
residuals from a fitted <code>mer</code> or <code>lmerMod</code> object. 
The function provides access to 
residual quantities already made available by the functions <code>resid</code> and
<code>ranef</code>, but adds additional functionality. Below is a list of types of
residuals that can be extracted.</p><dl>
<dt>raw level-1 residuals</dt><dd><p>These are equivalent to the residuals extracted
by <code>resid</code> if <code>level = 1</code>, <code>type = "EB"</code>, and 
<code>standardize = FALSE</code> is specified. 
You can also specify <code>type = "LS"</code> for LS residuals
that are not equivalent to those from <code>resid</code>.</p></dd>
<dt>standardized level-1 residuals</dt><dd><p>Specify <code>level = 1</code>, and 
<code>standardize = TRUE</code>. This works with both <code>type = "EB"</code> or <code>"LS"</code>.</p></dd>
<dt>semi-standardized level-1 residuals</dt><dd><p>Specify <code>level = 1</code>, <code>type = "LS"</code> and 
<code>standardize = "semi"</code>.</p></dd>
<dt>raw group level residuals</dt><dd><p>These are equivalent to extracting the 
predicted random effects for a given group using <code>ranef</code>. Set 
<code>level</code> to a grouping factor name and <code>type = "EB"</code>. <code>type = "LS"</code>
can also be specified, though this is less common.</p></dd>
<dt>standardized group level residuals</dt><dd><p>Set 
<code>level</code> to a grouping factor name, <code>type = "EB"</code>, and 
<code>standardized = TRUE</code>. This will not produce standardized residuals for
<code>type = "LS"</code>.</p></dd>
<dt>marginal residuals</dt><dd><p>The marginal residuals can be obtained by setting
<code>level = "marginal"</code>. Only <code>type = "EB"</code> is implemented.</p></dd>
<dt>cholesky residuals</dt><dd><p>These are essentially standardized marginal residuals.
To obtain cholesky residuals set <code>level = "marginal"</code>, <code>type = "EB"</code>,
and <code>standardize = TRUE</code>.</p></dd>

</dl><p>Note that <code>standardize = "semi"</code> is only implemented for level-1 LS residuals.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Hilden-Minton, J. (1995) Multilevel diagnostics for mixed and hierarchical 
linear models. University of California Los Angeles.</p>
<p>Houseman, E. A., Ryan, L. M., &amp; Coull, B. A. (2004) 
Cholesky Residuals for Assessing Normal Errors in a Linear 
Model With Correlated Outcomes. 
<em>Journal of the American Statistical Association</em>, <b>99</b>(466), 383--394.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='LSresids.default.html'>LSresids</a></code>, <code><a href='https://rdrr.io/r/stats/residuals.html'>resid</a></code>, <code><a href='https://rdrr.io/pkg/lme4/man/ranef.html'>ranef</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Adam Loy <a href='mailto:loyad01@gmail.com'>loyad01@gmail.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sleepstudy</span>, package <span class='op'>=</span> <span class='st'>"lme4"</span><span class='op'>)</span>
<span class='va'>fm1</span> <span class='op'>&lt;-</span> <span class='fu'>lme4</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lmer</a></span><span class='op'>(</span><span class='va'>Reaction</span> <span class='op'>~</span> <span class='va'>Days</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>Days</span><span class='op'>|</span><span class='va'>Subject</span><span class='op'>)</span>, <span class='va'>sleepstudy</span><span class='op'>)</span>

<span class='co'># level-1 residuals</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='fl'>1</span>, type <span class='op'>=</span> <span class='st'>"EB"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>resid</a></span><span class='op'>(</span><span class='va'>fm1</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>## EB</span>
<span class='va'>r1LS</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='fl'>1</span>, type <span class='op'>=</span> <span class='st'>"LS"</span><span class='op'>)</span> <span class='co'>## raw LS resids</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>r1LS</span><span class='op'>)</span>
<span class='va'>r1LS.std</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='fl'>1</span>, type <span class='op'>=</span> <span class='st'>"LS"</span>, standardize <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='co'>## std. LS resids</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>r1LS.std</span><span class='op'>)</span>

<span class='co'># level-2 residuals</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>r2EB</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='st'>"Subject"</span>, type <span class='op'>=</span> <span class='st'>"EB"</span><span class='op'>)</span>, 
                           <span class='fu'>lme4</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/ranef.html'>ranef</a></span><span class='op'>(</span><span class='va'>fm1</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"Subject"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>r2EB.std</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='st'>"Subject"</span>, type <span class='op'>=</span> <span class='st'>"EB"</span>, standardize <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>r2EB</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>r2EB.std</span><span class='op'>)</span>

<span class='co'># marginal residuals</span>
<span class='va'>mr</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='st'>"marginal"</span><span class='op'>)</span>
<span class='va'>cholr</span> <span class='op'>&lt;-</span> <span class='fu'>HLMresid</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>fm1</span>, level <span class='op'>=</span> <span class='st'>"marginal"</span>, standardize <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='co'># Cholesky residuals</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Adam Loy, Jaylin Lowe, Jack Moran.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


