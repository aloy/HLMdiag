<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculating residuals from HLMs — hlm_resid.default • HLMdiag</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculating residuals from HLMs — hlm_resid.default" />
<meta property="og:description" content="hlm_resid takes a hierarchical linear model fit as a lmerMod or
lme object and extracts residuals and predicted values from the model,
using Least Squares (LS) and Empirical Bayes (EB) methods. It then appends
them to the model data frame in the form of a tibble inspired by the augment
function in broom. This unified framework enables the analyst to more
easily conduct an upward residual analysis during model exploration/checking." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HLMdiag</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/hlm_resid.html">HLMdiag Residual Diagnostics</a>
    </li>
    <li>
      <a href="../articles/influence_diagnostics.html">HLMdiag Influence Diagnostics</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/aloy/HLMdiag/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculating residuals from HLMs</h1>
    <small class="dont-index">Source: <a href='https://github.com/aloy/HLMdiag/blob/master/R/hlm_resid.R'><code>R/hlm_resid.R</code></a></small>
    <div class="hidden name"><code>hlm_resid.lmerMod.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>hlm_resid</code> takes a hierarchical linear model fit as a <code>lmerMod</code> or
<code>lme</code> object and extracts residuals and predicted values from the model,
using Least Squares (LS) and Empirical Bayes (EB) methods. It then appends
them to the model data frame in the form of a tibble inspired by the <code>augment</code>
function in <code>broom</code>. This unified framework enables the analyst to more
easily conduct an upward residual analysis during model exploration/checking.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for default</span>
<span class='fu'>hlm_resid</span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for lmerMod</span>
<span class='fu'>hlm_resid</span>(
  <span class='no'>object</span>,
  <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>standardize</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>include.ls</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='co'># S3 method for lme</span>
<span class='fu'>hlm_resid</span>(
  <span class='no'>object</span>,
  <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>standardize</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>include.ls</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>an object of class <code>lmerMod</code> or <code>lme</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>do not use</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>which residuals should be extracted: 1 for within-group
(case-level) residuals, the name of a grouping factor for between-group
residuals (as defined in <code>flist</code> in <code>lmerMod</code> objects or in
<code>groups</code> in <code>lme</code> objects)</p></td>
    </tr>
    <tr>
      <th>standardize</th>
      <td><p>for any level, if <code>standardize = TRUE</code> the
standardized residuals will be returned for any group; for level-1 only, if
<code>standardize = "semi"</code> then the semi-standardized level-1 residuals
will be returned</p></td>
    </tr>
    <tr>
      <th>include.ls</th>
      <td><p>a logical indicating if LS residuals be included in the
return tibble. <code>include.ls = FALSE</code> decreases runtime substantially.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>if <code>na.action = na.exclude</code>, the user must provide the data
set used to fit the model, otherwise <code>NULL</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>hlm_resid</code> function provides a wrapper that will extract
residuals and predicted values from a fitted <code>lmerMod</code> or <code>lme</code>
object. The function provides access to residual quantities already made available by
the functions <code>resid</code>, <code>predict</code>, and <code>ranef</code>, but adds
additional functionality. Below is a list of types of residuals and predicted
values that are extracted and appended to the model data.</p><dl'>
<dt><strong>level-1 residuals</strong></dt><dd><p></p></dd>
<dt><code>.resid</code> and <code>.fitted</code></dt><dd><p>Residuals calculated using
the EB method (using maximum likelihood). Level-1 EB residuals are interrelated
with higher level residuals. Equivalent to the residuals extracted by
<code><a href='https://rdrr.io/r/stats/residuals.html'>resid(object)</a></code> and <code><a href='https://rdrr.io/r/stats/predict.html'>predict(object)</a></code> respectively. When
<code>standardize = TRUE</code>, residuals are standardized by sigma components of
the model object.</p></dd>
<dt><code>.ls.resid</code> and <code>.ls.fitted</code></dt><dd><p>Residuals calculated calculated
by fitting separate LS regression models for each group. Level-1 LS residuals
are unconfounded by higher level residuals, but unreliable for small
within-group sample sizes.</p></dd>
<dt><code>.mar.resid</code> and <code>.mar.fitted</code></dt><dd><p>Marginal residuals only
consider the fixed effect portion of the estimates. Equivalent to
<code><a href='https://rdrr.io/r/stats/residuals.html'>resid(object, level=0)</a></code> in <code>nlme</code>, not currently implemented
within the <code>lme4::resid</code> function. When <code>standardize = TRUE</code>,
cholskey marginal residuals are returned.</p></dd>
<dt><strong>higher-level residuals</strong> (random effects)</dt><dd><p></p></dd>
<dt><code>.ranef.var_name</code></dt><dd><p>The group level random effects using the EB method of
estimating parameters. Equivalent to <code>ranef(object)</code> on the specified
level. EB residuals are prefered at higher levels as LS residuals are dependent
on a large sample size.</p></dd>
<dt><code>.ls.var_name</code></dt><dd><p>The group level random effects using the LS method of
estimating parameters. Calculated using <code>ranef</code> on a <code>lmList</code>
object to compare the random effects of individual models to the global
model.</p></dd>

</dl><p>Note that <code>standardize = "semi"</code> is only implemented for level-1 LS residuals.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Hilden-Minton, J. (1995) Multilevel diagnostics for mixed and hierarchical 
linear models. University of California Los Angeles.</p>
<p>Houseman, E. A., Ryan, L. M., &amp; Coull, B. A. (2004) 
Cholesky Residuals for Assessing Normal Errors in a Linear 
Model With Correlated Outcomes. 
<em>Journal of the American Statistical Association</em>, 99(466), 383--394.</p>
<p>David Robinson and Alex Hayes (2020). broom: Convert Statistical Analysis
Objects into Tidy Tibbles. R package version 0.5.6.
<a href='https://CRAN.R-project.org/package=broom'>https://CRAN.R-project.org/package=broom</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='hlm_augment.lmerMod.html'>hlm_augment</a></code>, <code><a href='https://rdrr.io/r/stats/residuals.html'>resid</a></code>, <code>ranef</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>sleepstudy</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"lme4"</span>)
<span class='no'>fm.lmer</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>lme4</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lmer</a></span>(<span class='no'>Reaction</span> ~ <span class='no'>Days</span> + (<span class='no'>Days</span><span class='kw'>|</span><span class='no'>Subject</span>), <span class='no'>sleepstudy</span>)
<span class='no'>fm.lme</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>nlme</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nlme/man/lme.html'>lme</a></span>(<span class='no'>Reaction</span> ~ <span class='no'>Days</span>, <span class='kw'>random</span> <span class='kw'>=</span> ~<span class='no'>Days</span><span class='kw'>|</span><span class='no'>Subject</span>, <span class='no'>sleepstudy</span>)

<span class='co'># level-1 and marginal residuals</span>
<span class='no'>fm.lmer.res1</span> <span class='kw'>&lt;-</span> <span class='fu'>hlm_resid</span>(<span class='no'>fm.lmer</span>) <span class='co'>## raw level-1 and mar resids</span></div><div class='output co'>#&gt; <span class='error'>Error in hlm_resid(fm.lmer): could not find function "hlm_resid"</span></div><div class='input'><span class='no'>fm.lmer.res1</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'fm.lmer.res1' not found</span></div><div class='input'><span class='no'>fm.lme.std1</span> <span class='kw'>&lt;-</span> <span class='fu'>hlm_resid</span>(<span class='no'>fm.lme</span>, <span class='kw'>standardize</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) <span class='co'>## std level-1 and mar resids</span></div><div class='output co'>#&gt; <span class='error'>Error in hlm_resid(fm.lme, standardize = TRUE): could not find function "hlm_resid"</span></div><div class='input'><span class='no'>fm.lme.std1</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'fm.lme.std1' not found</span></div><div class='input'>
<span class='co'># level-2 residuals</span>
<span class='no'>fm.lmer.res2</span> <span class='kw'>&lt;-</span> <span class='fu'>hlm_resid</span>(<span class='no'>fm.lmer</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='st'>"Subject"</span>) <span class='co'>## level-2 ranefs</span></div><div class='output co'>#&gt; <span class='error'>Error in hlm_resid(fm.lmer, level = "Subject"): could not find function "hlm_resid"</span></div><div class='input'><span class='no'>fm.lmer.res2</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'fm.lmer.res2' not found</span></div><div class='input'><span class='no'>fm.lme.res2</span> <span class='kw'>&lt;-</span> <span class='fu'>hlm_resid</span>(<span class='no'>fm.lme</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='st'>"Subject"</span>, <span class='kw'>include.ls</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>) <span class='co'>##level-2 ranef, no LS</span></div><div class='output co'>#&gt; <span class='error'>Error in hlm_resid(fm.lme, level = "Subject", include.ls = FALSE): could not find function "hlm_resid"</span></div><div class='input'><span class='no'>fm.lme.res2</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'fm.lme.res2' not found</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Adam Loy, Jaylin Lowe, Jack Moran.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


